<!DOCTYPE html>
<html>
  <head> </head>
  <body>
    <p id="spot" style="font-size: 50pt">WAITING</p>
    <button id="startButton" onclick="doRequest()">Start!</button>
    <button class="button" style="font-size: 50pt; user-select: none">Vibrate</button>
    <script>
      var isMobile = /iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent);

      document.getElementById(".button").on("mousedown", function (e) {
        navigator.vibrate(1000); // Infinity is a number
      });

      document.getElementById(".button").on(isMobile ? "touchend" : "mouseup", function (e) {
        navigator.vibrate(0);
      });

      //credit for code below: Brian Ellis
      var lastTime = Date.now();
      function doRequest() {
        if (typeof DeviceMotionEvent.requestPermission === "function") {
          DeviceMotionEvent.requestPermission()
            .then((permissionState) => {
              if (permissionState === "granted") {
                // window.addEventListener('devicemotion', $scope.updateXY, true);
                window.addEventListener("deviceorientation", updateXY, true);
              }
            })
            .catch(console.error);
        } else {
          window.addEventListener("deviceorientation", updateXY, true);
        }
      }

      function updateXY(event) {
        let newTime = Date.now();
        if (newTime - lastTime < 300) {
          return;
        }
        lastTime = newTime;
        let alpha = event.alpha.toFixed(2);
        document.getElementById("spot").innerHTML = alpha;
      }

      doRequest();
    </script>
  </body>
</html>
